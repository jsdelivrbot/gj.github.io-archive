<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="words about programming, music, and sonic pi">

    <title>"Such Great Heights" in Sonic Pi</title>

    <link rel="canonical" href="/sonicpi/and_then_there_were_10">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/clean-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <a class="navbar-brand navbar-right" href="https://learn.co" target="_blank">
            <h6 class="powered_by">Powered by
                <svg id='svg__logo--text' viewBox='0 0 130.5 42' fill="currentColor" width="50" class="svg-center">
                  <path d='M41.2,29.5h13v5.1h-19V8h6V29.5z'/>
                  <path d='M61.1,26.7c0.4,2.6,1.9,4.1,4.3,4.1c1.5,0,2.6-0.5,3.4-1.7h5.7c-1.1,3.8-4.7,6.1-9.3,6.1 c-5.9,0-9.9-4.1-9.9-10.1c0-6,4-10.2,9.9-10.2c4.1,0,7.1,2,8.6,5.7c0.7,1.7,1,3.5,1,6.1H61.1z M68.9,22.7 c-0.2-2.3-1.6-3.5-3.8-3.5c-2.2,0-3.6,1.2-4.1,3.5H68.9z'/>
                  <path d='M77.7,21.4c0.4-4.4,3.1-6.6,8.5-6.6c2.9,0,5.1,0.7,6.7,2c1.4,1.2,1.9,2.8,1.9,5.6v8.9 c0,2.1,0.1,2.4,0.7,3.3h-5.8c-0.2-0.7-0.2-0.8-0.4-1.5c-1.9,1.6-3.2,2-5.5,2c-4.3,0-7.1-2.4-7.1-6c0-3.6,2.3-5.5,7.7-6.4l3.1-0.5 c1.3-0.2,1.7-0.5,1.7-1.3c0-1.1-1.1-1.8-3-1.8c-2.1,0-3.2,0.7-3.4,2.3H77.7z M89.3,25.5c-0.6,0.2-1.1,0.4-2.1,0.6l-2,0.4 c-2,0.5-2.9,1.2-2.9,2.3c0,1.3,1.1,2,2.9,2c1.9,0,3.2-0.8,4.2-2.4V25.5z'/>
                  <path d='M104.4,15.4l-0.2,3.4c1.1-3.1,2.6-4,6.7-4v5.3c-0.7-0.1-1-0.1-1.4-0.1c-2,0-3.6,0.9-4.2,2.3 c-0.6,1.3-0.8,3.1-0.8,6.8v5.4h-5.7V15.4H104.4z'/>
                  <path d='M118.5,15.4v1.9c2.1-1.9,3.3-2.4,5.3-2.4c4.2,0,6.7,2.8,6.7,7.3v12.5h-5.7V24.1c0-2-0.1-2.7-0.6-3.4 c-0.5-0.7-1.3-1.1-2.3-1.1c-1,0-1.8,0.4-2.4,1c-0.6,0.7-0.8,1.5-0.8,3.2v10.8H113V15.4H118.5z'/>
                  <path stroke-miterlimit='10' d='M15.1,22l8.4,0l-8.4,13.9V22z M12.4,5.6l0,13.7H4.1L12.4,5.6z M12.6,1L0.7,20.4c-0.2,0.3-0.2,0.7,0,1c0.2,0.4,0.6,0.5,1,0.5l10.8,0l0,18.4c0,0.5,0.3,1,0.8,1.1c0.1,0,0.2,0.1,0.3,0.1 c0.4,0,0.8-0.2,1-0.5l11.7-19c0.2-0.3,0.3-1.1,0.3-1.5c-0.2-0.8-0.5-1.2-1.2-1.2H15.2l0-17.5c0-0.5-0.4-1.1-1.3-1.2 c-0.1,0-0.2,0-0.3,0C13.2,0.5,12.8,0.7,12.6,1'/>
                </svg>
            </h6>
        </a>
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li>
                    <a href="/">Home</a>
                </li>

                <li>
                    <a href="/about/">About</a>
                </li>

                <li>
                  <a href="/sonicpi.html">Sonic Pi</a>
                </li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>

    <!-- Page Header -->
<header class="intro-header" style="background-image: url('/img/home-bg.png')">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="site-heading">
                    <h1>and then there were 10</h1>
                    <hr class="small">
                    <span class="subheading"></span>
                </div>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<div class="container">
	<div class="row">
		<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <p>Now that we have our two beautiful arrays, <code>patterns</code> and <code>order</code>, we need an equally-beautiful method to cycle through <code>order</code>, which will in turn make calls to <code>patterns</code>. Make sense? Kind of?</p>
      <p>Think of it like a road trip. The two arrays we created are a set of driving directions. They tell us where we're going and provide info on each leg of our trip, including when we have to make a turn or stop. But driving directions are only half of what you need to go on a road trip. We also need a car!</p>
      <img class=" size-full wp-image-1133 aligncenter" src="https://sonicpiblog.files.wordpress.com/2016/05/cars8.gif" alt="cars8" width="695" height="386" />
      <p>Our car / engine / machine / other metaphor will take the data stored in our two arrays (the driving directions) and execute it. At this point, the only pieces of code we need to keep are the two arrays and the <code>use_bpm</code> marker. We stored all of the vital timing info in <code>order</code>, and all of the notes have lived in <code>patterns</code> for a while; the rest is expendable. Delete it, and let's rebuild our car from the ground up.</p>
      <img class=" size-full wp-image-1134 aligncenter" src="https://sonicpiblog.files.wordpress.com/2016/05/cars9.gif" alt="cars9" width="695" height="406" />
      <p>Remember how we could call <code>patterns[0]</code> and have it return the contents of the first element in <code>patterns</code>? We can do the same for a three-dimensional array like <code>order</code>. When we call <code>order[0]</code>, it returns <code>[[0, 1], 7, 0]</code>. What we need now is to code an engine that will:
        <ul>
        	<li>Accept <code>[[0, 1], 7, 0]</code> as input</li>
        	<li>From those input values, make a set of instructions for Sonic Pi to play</li>
        	<li>After finishing with <code>order[0]</code>, move on to <code>order[1]</code>, then <code>order[2]</code>, and so on</li>
        </ul>
      For a preview of what our engine will look like, recall the following construct from the previous page:
      <pre><span style="color:#ccffcc;"><b>Y</b></span>.times do
  play_pattern_timed patterns[<span style="color:#ffff99;"><strong>X1</strong></span>], [0.5]
  play_pattern_timed patterns[<span style="color:#ffff99;"><strong>X2</strong></span>], [0.5] (<em>if necessary</em>)
  play_pattern_timed patterns[<span style="color:#ffff99;"><strong>X3</strong></span>], [0.5] (<em>if necessary</em>)
  play_pattern_timed patterns[<span style="color:#ffff99;"><strong>X4</strong></span>], [0.5] (<em>if necessary</em>)
end
sleep <span style="color:#ccffff;"><strong>Z</strong></span></pre>
Let's get our assembly line going with a bit of Ruby-magic.</p>
      <p>Ruby has <a href="http://ruby-doc.org/core/Array.html#class-Array-label-Iterating+over+Arrays" target="_blank">an awesome, built-in method for iterating through all items within an array</a> called <code>each</code>. When you call <code>each</code> on an array (like so: <code>array_name.each</code>), Ruby will return, successively, every element in the array from slot <code>0</code> to slot <code>n-1</code>. This will come in handy twice in the manufacture of our vehicle. (The metaphors will peter out soon - I promise.)</p>
      <p>The first thing we're going to do with <code>each</code> is construct the framework for our method -- the body for our car. (I may have lied about the metaphors. You can submit complaints <a href="https://goo.gl/SsAhv" target="_blank">here</a>.) The following line of Sonic Pi code will iterate through the seven elements stored within <code>order</code>, calling them sequentially and storing the three values returned from each in three <a href="http://mixandgo.com/blog/mastering-ruby-blocks-in-less-than-5-minutes" target="_blank">block parameters</a> named <code>patterns_sequence</code>, <code>repeat</code>, and <code>sleep_after</code>:
      <pre><strong>order.each do |patterns_sequence, repeat, sleep_after|

end</strong>
</pre>
As we build out the inner-workings of our car, we'll use the values from <code>order[0]</code> -- that is, from <code>[[0, 1], 7, 0]</code>, the first element stored in <code>order</code> -- to illustrate what's going on under the hood. When <code>order.each</code> passes that first element into its <code>do</code> / <code>end</code> block, the three parameters are set as follows:
<ul>
	<li><code>patterns_sequence</code> is set equal to <code>[0, 1]</code></li>
	<li><code>repeat</code> is set equal to <code>7</code></li>
	<li><code>sleep_after</code> is set equal to <code>0</code></li>
</ul>
To demonstrate how the parameters are then handled, let's add some brakes to our car -- a line of code that tells Sonic Pi to <code>sleep</code> for the duration of the value stored in the <code>sleep_after</code> parameter:
<pre>order.each do |patterns_sequence, repeat, sleep_after|

  <strong>sleep sleep_after</strong>
end</pre>
When <code>order[0]</code> is passed in, <code>sleep sleep_after</code> becomes <code>sleep 0</code>. When <code>order[1]</code> is passed in, it becomes <code>sleep 128</code>.</p>
      <p>I left a blank line above the <code>sleep</code> method in anticipation of the other methods (implementing <code>patterns_sequence</code> and <code>repeat</code>) yet to come. We know that <code>sleep</code> will be the last method called because the <code>sleep</code> values we recorded in <code>order</code> indicate how long to <code>sleep</code> <em>after</em> the pattern of notes (with any repeats) has run.</p>
      <p>Speaking of repeats, let's add them in now:
      <pre>order.each do |patterns_sequence, repeat, sleep_after|
  <strong>repeat.times do

  end</strong>
  sleep sleep_after
end</pre>
If you understood <code>sleep sleep_after</code>, this one is pretty straightforward. <code>repeat</code> values from <code>order</code> are parameterized and passed into the <code>repeat.times</code> formula. When <code>order[0]</code> is passed in, <code>repeat.times do</code> becomes <code>7.times do</code>. When <code>order[1]</code> is passed in, it becomes <code>1.times do</code>.</p>
<p>Finally, we have to implement the most important piece of <a href="http://www.cartalk.com/content/puzzlers" target="_blank">the car puzzle</a>: some code to play the sequences (stored in <code>order</code>) of notes (stored in <code>patterns</code>). We can break it down into three steps:
<ul>
	<li>Iterate through the array passed to our engine as <code>patterns_sequence</code></li>
	<li>Parameterize each iterated value and pass it down to the <code>play_pattern_timed</code> method at the core of our engine block</li>
	<li>Using that iterated value, run <code>play_pattern_timed</code> on the element from <code>patterns</code> (F-pattern, E-pattern, D-pattern, or A-pattern) that is stored at the index (0, 1, 2, or 3) matching the passed-down, iterated value</li>
</ul>
That probably sounds a little confusing, but let's attack it step-by-step.</p>
<p>First, we can iterate through <code>patterns_sequence</code> with <code>patterns_sequence.each</code>. We also have to create a parameter for the accompanying <code>do</code> / <code>end</code> block to pass down. Since this parameter is essentially an index number for the <code>patterns</code> array, let's name our parameter <code>index</code>.
<pre>order.each do |patterns_sequence, repeat, sleep_after|
  repeat.times do
    <strong>patterns_sequence.each do |index|

    end</strong>
  end
  sleep sleep_after
end</pre>
Then, we have to create a <code>play_pattern_timed</code> method that calls to whichever slot in <code>patterns</code> is passed down via the <code>index</code> parameter. We know that <code>patterns[0]</code> calls the first slot in <code>patterns</code> and <code>patterns[n]</code> calls the nth slot, so <code>patterns[index]</code> will call the... indexth slot. Or whatever. Tack the <code>sleep</code> array (<code>[0.5]</code>) onto the end of our <code>play_pattern_timed</code> method, and let's step back and admire our finished beauty:
<pre>order.each do |patterns_sequence, repeat, sleep_after|
  repeat.times do
    patterns_sequence.each do |index|
      <strong>play_pattern_timed patterns[index], [0.5]</strong>
    end
  end
  sleep sleep_after
end</pre>
Ten short lines (including the two arrays) is all it took to create the entire rhythmic synth score!</p>
		</div>
	</div>

	<div class="row">
		<div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
	<nav>
		<ul class="pager">
			<li class="previous"><a href="standardization"><span aria-hidden="true">&larr;</span>Previous</a></li>
			<li class="next"><a href="verbosity">Next<span aria-hidden="true">&rarr;</span></a></li>
		</ul>
	</nav>
		</div>
	</div>
</div>

<hr>

    <!-- Footer -->
<footer>
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <ul class="list-inline text-center">
                    <li>
                        <a href="https://learn.co/ga-be">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <span class="learn-icon">&#66;</span>
                            </span>
                        </a>
                    </li>

                    <li>
                        <a href="https://twitter.com/gabe_jackson">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>

                    <li>
                        <a href="https://github.com/ga-be">
                            <span class="fa-stack fa-lg">
                                <i class="fa fa-circle fa-stack-2x"></i>
                                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
                <p class="copyright text-muted">Copyright &copy; ga-be 2016</p>
            </div>
        </div>
    </div>
</footer>

<!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/clean-blog.min.js "></script>

</body>

</html>
